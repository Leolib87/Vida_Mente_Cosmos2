<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Línea de Tiempo Cinematográfica | Exploración Transdisciplinaria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root {
            --primary: #818cf8;
            --primary-dark: #6366f1;
            --secondary: #22d3ee;
            --primary-text: #e5e7eb;
            --primary-glow: #818cf8;
            --secondary-glow: #22d3ee;
            --font-main: 'Inter', sans-serif;
            --font-accent: 'Orbitron', sans-serif;
            --nav-height: 70px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            background-color: #0a0a1a;
            color: var(--primary-text);
            font-family: var(--font-main);
            line-height: 1.8;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .glassmorphism {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.menu-open { overflow: hidden; }
        
        nav {
            position: fixed; top: 0; width: 100%; height: var(--nav-height);
            z-index: 1000; display: flex; justify-content: center; align-items: center;
            padding: 0 5%; pointer-events: auto;
        }
        .nav-content { display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 1440px; margin: 0 auto; }
        .nav-logo a {
            font-size: 1.3em; font-weight: 700; color: #fff; text-decoration: none;
            text-shadow: 0 0 8px var(--primary-glow); display: flex; align-items: center; gap: 0.75rem;
        }
        .nav-container { display: flex; justify-content: center; align-items: center; list-style: none; height: 100%; gap: 0.5rem;}
        nav .nav-container > li { position: relative; height: 100%; display: flex; align-items: center; }
        nav .nav-container > li > a {
            color: var(--primary-text); text-decoration: none; font-size: clamp(0.9em, 1.2vw, 1.05em); font-weight: 500;
            transition: color 0.3s ease, text-shadow 0.3s ease; padding: 0 1rem; display: flex; align-items: center; gap: 8px;
        }
        nav .nav-container > li > a:hover, nav .nav-container > li:hover > a { color: #FFFFFF; text-shadow: 0 0 12px var(--primary-glow); }
        .nav-icon { width: 20px; height: 20px; stroke-width: 1.5; }
        
        .mega-menu {
            position: fixed; top: var(--nav-height); left: 50%; transform: translateX(-50%) scale(0.95);
            border-radius: 10px; width: auto; min-width: clamp(300px, 80vw, 950px); max-width: 95vw;
            padding: 2rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 2rem; opacity: 0; visibility: hidden;
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0s 0.3s;
            transform-origin: top center;
        }
        .mega-menu.is-active { 
            opacity: 1; visibility: visible; transform: translateX(-50%) scale(1);
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0s 0s;
        }
        .mega-menu h3 {
            color: var(--primary-glow); font-size: 1.1em; margin-bottom: 1rem;
            text-shadow: 0 0 5px var(--primary-glow); border-bottom: 1px solid rgba(129, 140, 248, 0.3);
            padding-bottom: 0.75rem; display: flex; align-items: center; gap: 0.75rem;
        }
        .mega-menu ul { display: flex; flex-direction: column; gap: 0.75rem; list-style: none; padding-left:0; }
        .mega-menu a {
            font-size: 0.9em; color: var(--primary-text); text-decoration: none;
            transition: color 0.3s, padding-left 0.3s, background-color 0.3s;
            padding: 0.5rem 0.75rem 0.5rem 2rem; border-radius: 4px; display: block; position: relative;
        }
        .mega-menu a::before {
            content: '›'; color: var(--primary-glow); position: absolute; left: 0.75rem; top: 50%;
            transform: translateY(-50%); font-size: 1.2em; transition: color 0.3s;
        }
        .mega-menu a:hover { color: #000; background-color: var(--primary-glow); padding-left: 2.5rem; }
        .mega-menu a:hover::before { color: #000; }
        
        .main-container { 
            width: 100%; max-width: 1440px; margin: 0 auto; 
            padding-top: var(--nav-height);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .hero {
            text-align: center; position: relative; padding: 2rem 1rem;
        }
        .hero h1 {
            font-family: var(--font-accent);
            font-size: clamp(2rem, 6vw, 3.5rem); font-weight: 700; color: var(--secondary);
            text-shadow: 0 0 10px var(--secondary-glow), 0 0 20px var(--secondary-glow), 0 0 40px rgba(34, 211, 238, 0.7);
            animation: pulse-glow 3s infinite alternate;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .hero p { font-size: clamp(0.9rem, 2vw, 1.1rem); max-width: 800px; margin: 1rem auto 0; text-shadow: 0 0 5px #000; }
        
        @keyframes pulse-glow {
            from { text-shadow: 0 0 10px var(--secondary-glow), 0 0 20px var(--secondary-glow); }
            to { text-shadow: 0 0 20px var(--secondary-glow), 0 0 40px var(--secondary-glow); }
        }

        .footer { text-align: center; padding: 2rem 1rem; color: var(--primary-glow); border-top: 1px solid var(--primary-text); margin-top: 2rem; }

        /* --- STYLES FOR THIS SPECIFIC PAGE --- */
        .canvas-wrapper {
            position: relative;
            flex-grow: 1;
            display: grid;
            grid-template-columns: 1fr 2fr;
            align-items: start;
            gap: 2rem;
            margin-top: 1rem;
            min-height: 0;
        }
        #movie-titles-column {
            text-align: right;
        }
        .movie-title {
            display: flex; align-items: center; justify-content: flex-end;
            font-weight: 600; color: #a0aec0; font-size: clamp(0.6rem, 1.2vw, 0.875rem);
            text-transform: uppercase;
            transition: color 0.3s, text-shadow 0.3s;
            white-space: nowrap;
        }
        .movie-title.highlighted {
            color: var(--secondary);
            text-shadow: 0 0 8px var(--secondary-glow);
        }
        #p5-canvas-container {
            width: 100%;
            height: 100%;
            min-height: 400px;
            cursor: pointer;
        }
        #three-canvas-container {
            position: absolute;
            /* CAMBIO: Aquí puedes modificar el tamaño del planeta */
            width: clamp(350px, 30vw, 500px); 
            height: clamp(350px, 30vw, 500px);
            border-radius: 50%; overflow: hidden;
            box-shadow: 0 0 40px rgba(34, 211, 238, 0.7), inset 0 0 30px rgba(34, 211, 238, 0.5);
            border: 3px solid rgba(34, 211, 238, 0.8);
            transition: top 0.5s ease, left 0.5s ease, transform 0.5s ease;
            /* CAMBIO: Aquí puedes modificar la posición vertical del planeta */
            top: 35%;
            right: 5%;
            transform: translateY(-50%);
            opacity: 0;
            animation: fadeIn 2s ease-in-out forwards;
            pointer-events: none;
        }
        #three-canvas-container.interactive { pointer-events: all; }
        #three-canvas-container canvas {
            display: block; width: 100% !important; height: 100% !important;
        }
        #timeline-tooltip {
            position: fixed;
            display: none;
            background: rgba(10, 10, 26, 0.9);
            border: 1px solid var(--secondary);
            color: var(--primary-text);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            pointer-events: none;
            z-index: 9999;
            box-shadow: 0 0 15px var(--secondary-glow);
            text-align: center;
        }

        @keyframes fadeIn { to { opacity: 1; } }

        @media (max-width: 1200px) {
            .canvas-wrapper { grid-template-columns: 1fr 1.5fr; }
            #three-canvas-container { right: 2%; }
        }

        @media (max-width: 900px) {
            .canvas-wrapper { grid-template-columns: 1fr; }
            #movie-titles-column { text-align: center; padding-top: 0; }
            .movie-title { justify-content: center; }
            #three-canvas-container { display: none; }
        }

        @media (max-width: 1024px) {
            .nav-content { justify-content: space-between; }
            .nav-container {
                position: fixed; top: var(--nav-height); left: 0; width: 100%;
                height: calc(100vh - var(--nav-height)); background: rgba(17, 24, 39, 0.95);
                backdrop-filter: blur(15px); flex-direction: column; justify-content: flex-start;
                align-items: center; transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
                transform: translateY(-110%); overflow-y: auto; padding: 2rem;
            }
            body.menu-open .nav-container { transform: translateY(0); }
            nav .nav-container > li { width: 100%; height: auto; flex-direction: column; align-items: center; text-align: center; }
            nav .nav-container > li > a { padding: 1rem; width: 100%; font-size: 1.5em;}
            .mega-menu {
                position: static; display: grid; opacity: 1; transform: none; visibility: visible; width: 100%; box-shadow: none; 
                border: none; padding: 1rem 0 1.5rem 0; background: none; backdrop-filter: none;
                grid-template-columns: 1fr; border-top: 1px solid rgba(129, 140, 248, 0.2); margin-top: 1rem;
            }
            .mega-menu h3 { text-align: center; font-size: 1.8em; }
            .mega-menu ul { align-items: stretch; text-align: left; list-style: none; padding-left: 0; }
            .mega-menu a { font-size: 1.5em; padding: 0.8rem 1rem 0.8rem 2.5rem; display: block; text-align: left; position: relative; }
            .mega-menu a::before {
                content: '■'; color: var(--primary-glow); position: absolute; left: 0.5rem; top: 50%;
                transform: translateY(-50%) scale(0.6); font-size: 1.5em;
            }
            .mega-menu a:hover { padding-left: 2.5rem; color: #000; background-color: var(--primary-glow); }
            .mega-menu a:hover::before { color: #000; }
            .menu-toggle {
                display: block; position: relative; z-index: 1001;
                width: 30px; height: 22px; background: none; border: none; cursor: pointer;
            }
            .icon-bar {
                display: block; width: 100%; height: 3px; background-color: var(--primary-text); 
                margin: 6px 0; transition: all 0.3s ease-in-out; border-radius: 2px;
            }
            body.menu-open .menu-toggle .icon-bar:nth-child(1) { transform: rotate(45deg) translate(7px, 7px); }
            body.menu-open .menu-toggle .icon-bar:nth-child(2) { opacity: 0; }
            body.menu-open .menu-toggle .icon-bar:nth-child(3) { transform: rotate(-45deg) translate(7px, -7px); }
        }
        @media (min-width: 1025px) { .menu-toggle { display: none; } .nav-container { display: flex; } }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="glassmorphism">
        <div class="nav-content">
            <div class="nav-logo">
                <a href="index.html">
                    <img src="https://placehold.co/40x40/818cf8/000000?text=O" alt="Logo O.C.V.M." class="h-8 w-8 md:h-10 md:w-10 rounded-full">
                    <span>O.C.V.M.</span>
                </a>
            </div>
            <ul class="nav-container" id="nav-menu">
                <li><a href="index.html">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg>
                    Inicio</a></li>
                <li><a href="#">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" /></svg>
                    Cosmos</a>
                    <div class="mega-menu glassmorphism">
                        <div><h3><svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 7.5l3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0021 18V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v12a2.25 2.25 0 002.25 2.25z" /></svg>Sistemas Complejos</h3>
                            <ul>
                                <li><a href="GAME_OF_LIFE.HTML">Juego de la Vida (Conway)</a></li>
                                <li><a href="GAME_OF_LIFE3D.HTML">Juego de la Vida (3D)</a></li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li><a href="#">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.25 9.75L16.5 12l-2.25 2.25m-4.5 0L7.5 12l2.25-2.25M6 20.25h12A2.25 2.25 0 0020.25 18V5.75A2.25 2.25 0 0018 3.5H6A2.25 2.25 0 003.75 5.75v12.5A2.25 2.25 0 006 20.25z" /></svg>
                    Vida</a>
                    <div class="mega-menu glassmorphism">
                        <div><h3><svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 4.5v15m6-15v15m-10.875 0h15.75c.621 0 1.125-.504 1.125-1.125V5.625c0-.621-.504-1.125-1.125-1.125H4.125C3.504 4.5 3 5.004 3 5.625v12.75c0 .621.504 1.125 1.125 1.125z" /></svg>Fundamentos de Biología</h3>
                            <ul>
                                <li><a href="CURSO_BIOLOGIA_CELULAR.HTML">Curso Biología Celular</a></li>
                                <li><a href="HISTOLOGIA.html">Histología y Tejidos</a></li>
                            </ul>
                        </div>
                        <div><h3><svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.667 0l3.181-3.183m-4.991-2.691v4.992h4.992v-.001M2.985 19.644l3.181-3.182m0-4.992l-3.181 3.183a8.25 8.25 0 0011.667 0l3.181-3.183" /></svg>Autopoiesis</h3>
                            <ul>
                                <li><a href="AUTOPOIESIS.HTML">Simulación Autopoiesis</a></li>
                                <li><a href="Paper_Varela_1974.html">Paper de Varela (1974)</a></li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li><a href="#">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 002.25-2.25V6.75a2.25 2.25 0 00-2.25-2.25H6.75A2.25 2.25 0 004.5 6.75v10.5a2.25 2.25 0 002.25 2.25zm.75-12h9v9h-9v-9z" /></svg>
                    Mente</a>
                     <div class="mega-menu glassmorphism">
                        <div><h3><svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>Filosofía y Cognición</h3>
                            <ul>
                                <li><a href="Feno_style.html">Aproximación Fenomenológica</a></li>
                                <li><a href="conocer_fv.html">El Árbol del Conocimiento</a></li>
                            </ul>
                        </div>
                        <div><h3><svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.436 60.436 0 00-.491 6.347A48.627 48.627 0 0112 20.904a48.627 48.627 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.57 50.57 0 00-2.658-.813A59.905 59.905 0 0112 3.493a59.902 59.902 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0l-1.07-1.07m15.482 0l1.07 1.07m-1.07-1.07l-1.07 1.07m1.07-1.07l-1.07 1.07m-1.07-1.07l-1.07 1.07m2.14 0l-1.07 1.07M12 6.873l-1.07 1.07m2.14 0l-1.07-1.07m-1.07 1.07l-1.07-1.07m2.14 0l-1.07 1.07m-1.07 1.07l-1.07-1.07m2.14 0l-1.07 1.07" /></svg>Reflexiones Culturales</h3>
                            <ul>
                                <li><a href="peliculas.html">Reflexiones en el Cine</a></li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li><a href="#">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 107.5 7.5h-7.5V6z" /><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0013.5 3v7.5z" /></svg>
                    Cartografías</a>
                     <div class="mega-menu glassmorphism">
                        <div><h3><svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 20.25h12A2.25 2.25 0 0020.25 18V5.75A2.25 2.25 0 0018 3.5H6A2.25 2.25 0 003.75 5.75v12.5A2.25 2.25 0 006 20.25z" /></svg>Visualización de Datos</h3>
                            <ul>
                                <li><a href="varios graficos.html">Colección de Gráficos</a></li>
                                <li><a href="INFLACION ARGENTINA RESPONSIVA.html">Inflación en Argentina</a></li>
                            </ul>
                        </div>
                        <div><h3><svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15" /></svg>Mapas Conceptuales</h3>
                            <ul>
                                <li><a href="VARELA_CARTOGRAFIA.HTML">Cartografía Varela (3D)</a></li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li><a href="#">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" /></svg>
                    Contacto</a></li>
            </ul>
            <button class="menu-toggle" id="menu-toggle-btn" aria-label="Abrir o cerrar menú">
                <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        <div class="hero">
            <h1>Línea de Tiempo Cinematográfica</h1>
            <p>Una exploración visual de los futuros imaginados en el cine.</p>
        </div>

        <div class="canvas-wrapper">
            <div id="movie-titles-column"></div>
            <div id="p5-canvas-container"></div>
            <div id="three-canvas-container"></div>
        </div>

    </div>
    <footer class="footer" id="contacto">
        <p>Este espacio es una cartografía personal y una invitación al diálogo.</p>
        <p style="margin-top:1.5rem; font-size: 0.9em;">La vida es terriblemente bella cuando los jugadores juegan. | 2025</p>
    </footer>
    
    <!-- Tooltip Element -->
    <div id="timeline-tooltip"></div>

    <script>
        // --- GLOBAL STATE & DATA ---
        let hoveredMovieIndex = -1;
        let p5Instance; // To hold the p5 instance
        const movies = [
            { title: "Clockwork Orange", year: 1995 }, { title: "Escape from NY", year: 1997 },
            { title: "2001: A Space Odyssey", year: 2001 }, { title: "Freejack", year: 2009 },
            { title: "The Postman", year: 2013 }, { title: "Robocop", year: 2015 },
            { title: "Back To The Future II", year: 2015 }, { title: "The Running Man", year: 2017 },
            { title: "Rollerball", year: 2018 }, { title: "Blade Runner", year: 2019 },
            { title: "Soylent Green", year: 2022 }, { title: "Children of Men", year: 2027 },
            { title: "12 Monkeys", year: 2028 }, { title: "Demolition Man", year: 2032 },
            { title: "V for Vendetta", year: 2038 }, { title: "Event Horizon", year: 2047 },
            { title: "Minority Report", year: 2054 }, { title: "Total Recall", year: 2084 },
            { title: "A.I. Artificial Intelligence", year: 2101 }, { title: "Alien", year: 2122 },
            { title: "The Black Hole", year: 2130 }, { title: "Sleeper", year: 2173 },
            { title: "The Matrix", year: 2199 }, { title: "Forbidden Planet", year: 2220 },
            { title: "The Fifth Element", year: 2263 }, { title: "Zardoz", year: 2293 },
            { title: "Star Trek: The Motion Picture", year: 2387 }, { title: "Logan's Run", year: 2500 },
            { title: "Idiocracy", year: 2505 }, { title: "Planet of The Apes", year: 3978, displayYear: "3978" },
            { title: "Dune", year: 10191, displayYear: "10,191" },
            { title: "Barbarella", year: 40000, displayYear: "40,000" }
        ].sort((a,b) => a.year - b.year);
        const yearStart = 1990;
        const yearEnd = 41000;

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            setupNavigation();
            populateTitles();
            initThree();
            animateThree();
            p5Instance = new p5(sketch);

            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    onWindowResize();
                    if(p5Instance) {
                        p5Instance.windowResized();
                    }
                }, 250);
            });
        });

        // --- NAVIGATION SCRIPTS ---
        function setupNavigation() {
            const menuToggleBtn = document.getElementById('menu-toggle-btn');
            const navMenu = document.getElementById('nav-menu');

            menuToggleBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                document.body.classList.toggle('menu-open');
            });

            navMenu.addEventListener('click', (e) => {
                const isLink = e.target.tagName === 'A' || e.target.closest('a');
                if (isLink && window.innerWidth <= 1024) {
                   const megaMenu = e.target.closest('.mega-menu');
                   if(!megaMenu) {
                        document.body.classList.remove('menu-open');
                   }
                }
            });

            if (window.matchMedia('(min-width: 1025px)').matches) {
                const menuItems = document.querySelectorAll('.nav-container > li');
                menuItems.forEach(item => {
                    const megaMenu = item.querySelector('.mega-menu');
                    if (megaMenu) {
                        let leaveTimeout;
                        const showMenu = () => {
                            clearTimeout(leaveTimeout);
                            document.querySelectorAll('.mega-menu.is-active').forEach(m => {
                                if (m !== megaMenu) m.classList.remove('is-active');
                            });
                            megaMenu.classList.add('is-active');
                        };
                        const startHideTimer = () => {
                            leaveTimeout = setTimeout(() => megaMenu.classList.remove('is-active'), 250);
                        };
                        item.addEventListener('mouseenter', showMenu);
                        item.addEventListener('mouseleave', startHideTimer);
                    }
                });
            }
        }

        // --- DOM MANIPULATION & INTERACTIVITY ---
        function populateTitles() {
            const titlesColumn = document.getElementById('movie-titles-column');
            titlesColumn.innerHTML = ''; 
            movies.forEach((movie, index) => {
                // CAMBIO: Se crea un enlace <a> en lugar de un div
                const titleEl = document.createElement('a');
                titleEl.className = 'movie-title';
                titleEl.textContent = movie.title;
                titleEl.dataset.index = index;
                // Se construye la URL de Wikipedia a partir del título de la película
                const wikipediaTitle = movie.title.replace(/ /g, '_');
                titleEl.href = `https://es.wikipedia.org/wiki/${wikipediaTitle}`;
                // Se abre el enlace en una nueva pestaña
                titleEl.target = "_blank";
                titlesColumn.appendChild(titleEl);
            });
        }
        
        function updateTitleStyles(barHeight, barSpacing, firstBarY) {
              const titles = document.querySelectorAll('.movie-title');
              const titlesColumn = document.getElementById('movie-titles-column');
              if(!titlesColumn) return;

              titlesColumn.style.paddingTop = `${firstBarY - barHeight / 2}px`;
              titles.forEach(title => {
                title.style.height = `${barHeight}px`;
                title.style.marginBottom = `${barSpacing}px`;
              });
        }

        function updateDOMOnHover(index) {
            const titles = document.querySelectorAll('.movie-title');
            titles.forEach((title, i) => {
                title.classList.toggle('highlighted', i === index);
            });

            const tooltip = document.getElementById('timeline-tooltip');
            if (index !== -1) {
                const movie = movies[index];
                tooltip.style.display = 'block';
                tooltip.innerHTML = `<strong>${movie.title}</strong><br>${movie.displayYear || movie.year}`;
            } else {
                tooltip.style.display = 'none';
            }
        }

        document.addEventListener('mousemove', (e) => {
            const tooltip = document.getElementById('timeline-tooltip');
            if (tooltip.style.display === 'block') {
                tooltip.style.left = `${e.clientX + 15}px`;
                tooltip.style.top = `${e.clientY + 15}px`;
            }
        });

        // --- P5.JS SKETCH ---
        const sketch = (p) => {
            const container = document.getElementById('p5-canvas-container');
            let barHeight, barSpacing, totalHeight, firstBarY;
            let stars = [];
            let animationProgress = 0; 

            function calculateDimensions() {
                totalHeight = container.offsetHeight;
                let singleEntryHeight = totalHeight / movies.length;
                barHeight = singleEntryHeight * 0.8;
                barSpacing = singleEntryHeight * 0.2;
                firstBarY = barHeight / 2;
                updateTitleStyles(barHeight, barSpacing, firstBarY);
            }

            p.setup = () => {
                calculateDimensions();
                let cnv = p.createCanvas(container.offsetWidth, totalHeight);
                cnv.parent('p5-canvas-container');
                p.frameRate(60);
                for (let i = 0; i < 200; i++) {
                    stars.push({
                        x: p.random(p.width), y: p.random(p.height),
                        size: p.random(1, 3), alpha: p.random(50, 150)
                    });
                }
            };

            p.draw = () => {
                p.background('#0a0a1a');
                if (animationProgress < 1) {
                    animationProgress += 0.05;
                }
                animationProgress = p.min(animationProgress, 1);

                drawStarfield();
                handleHover();
                drawTimeline();
                drawYouAreHere();
            };
            
            p.windowResized = () => {
                if(!container.offsetWidth) return;
                calculateDimensions();
                p.resizeCanvas(container.offsetWidth, totalHeight);
            };
            
            function handleHover() {
                let foundIndex = -1;
                for (let i = 0; i < movies.length; i++) {
                    const yPos = i * (barHeight + barSpacing) + firstBarY;
                    if (p.mouseY > yPos - barHeight / 2 && p.mouseY < yPos + barHeight / 2) {
                        foundIndex = i;
                        break;
                    }
                }
                if (foundIndex !== hoveredMovieIndex) {
                    hoveredMovieIndex = foundIndex;
                    updateDOMOnHover(hoveredMovieIndex);
                }
            }

            function drawStarfield() {
                p.noStroke();
                stars.forEach(star => {
                    star.x -= star.size * 0.05;
                    if (star.x < 0) star.x = p.width;
                    p.fill(255, star.alpha);
                    p.circle(star.x, star.y, star.size);
                });
            }

            function drawTimeline() {
                movies.forEach((movie, i) => {
                    const yPos = i * (barHeight + barSpacing) + firstBarY;
                    const logYear = Math.log(movie.year - yearStart + 1);
                    const logEnd = Math.log(yearEnd - yearStart + 1);
                    const barWidth = p.map(logYear, 0, logEnd, 0, p.width * 0.8);
                    const animatedWidth = barWidth * p.easing.easeOutCubic(animationProgress);

                    p.noStroke();
                    let gradient = p.drawingContext.createLinearGradient(0, yPos, animatedWidth, yPos);
                    gradient.addColorStop(0, '#22d3ee');
                    gradient.addColorStop(0.8, '#818cf8');
                    gradient.addColorStop(1, '#6366f1');
                    p.drawingContext.fillStyle = gradient;
                    
                    if (i === hoveredMovieIndex) {
                        p.stroke(255, 255, 255, 200);
                        p.strokeWeight(2);
                    } else {
                        p.noStroke();
                    }
                    p.rectMode(p.CENTER);
                    p.rect(animatedWidth / 2, yPos, animatedWidth, barHeight, 5);
                    p.rectMode(p.CORNER);

                    p.noStroke();
                    p.fill(255);
                    p.textFont('Orbitron');
                    p.textSize(p.max(8, barHeight * 0.4));
                    p.textAlign(p.LEFT, p.CENTER);
                    const yearText = movie.displayYear || movie.year;
                    p.text(yearText, animatedWidth + 15, yPos);
                });
            }
            
            p.easing = { easeOutCubic: t => (--t)*t*t+1 };

            function drawYouAreHere() {
                const currentYear = 2025;
                let prevMovie = movies.findLast(m => m.year <= currentYear);
                let nextMovie = movies.find(m => m.year > currentYear);
                
                if (!prevMovie || !nextMovie) return;

                const prevIndex = movies.indexOf(prevMovie);
                const nextIndex = movies.indexOf(nextMovie);

                const prevY = prevIndex * (barHeight + barSpacing) + firstBarY;
                const nextY = nextIndex * (barHeight + barSpacing) + firstBarY;
                
                const yearFraction = (currentYear - prevMovie.year) / (nextMovie.year - prevMovie.year);
                const yPos = p.lerp(prevY, nextY, yearFraction);

                const logYear = Math.log(currentYear - yearStart + 1);
                const logEnd = Math.log(yearEnd - yearStart + 1);
                const xPos = p.map(logYear, 0, logEnd, 0, p.width * 0.8);
                
                // --- PARÁMETROS DE LA FLECHA "ESTÁS AQUÍ" (AQUÍ PUEDES HACER CAMBIOS)
                // Modifica este valor para cambiar la altura del cuerpo de la flecha
                const newRectHeight = p.max(10, barHeight * 0.4); 
                // Modifica este valor para cambiar el tamaño de la punta
                const newArrowHeadSize = newRectHeight * 0.5;
                // Modifica este valor para cambiar la longitud del cuerpo de la flecha
                const arrowBodyLength = p.width > 600 ? 55 : 40; 
                // Modifica este valor para cambiar la posición de la punta de la flecha
                const tipOffset = 45; 
                
                // Estos valores definen el cuerpo de la flecha
                const newTipX = xPos + tipOffset;
                const newEndX = newTipX + newArrowHeadSize; 
                const startX = p.min(p.width, newEndX + arrowBodyLength);

                p.fill(220, 53, 69, 220);
                p.stroke(255, 100, 100);
                p.strokeWeight(1);

                // Asegurar que la flecha esté por encima del planeta (z-index simulado por orden de dibujo)
                p.beginShape();
                p.vertex(startX, yPos - newRectHeight / 2);
                p.vertex(newEndX, yPos - newRectHeight / 2);
                p.vertex(newEndX, yPos - newRectHeight / 2 - newArrowHeadSize);
                p.vertex(newTipX, yPos);
                p.vertex(newEndX, yPos + newRectHeight / 2 + newArrowHeadSize);
                p.vertex(newEndX, yPos + newRectHeight / 2);
                p.vertex(startX, yPos + newRectHeight / 2);
                p.endShape(p.CLOSE);

                p.noStroke();
                p.fill(255);
                p.textFont('Orbitron');
                p.textStyle(p.BOLD);
                p.textSize(p.width > 400 ? 8 : 6);
                p.textAlign(p.CENTER, p.CENTER);
                p.text("ESTÁS AQUÍ", (startX + newEndX) / 2, yPos);
                // ------------------------------------
            }
        };
        
        // --- THREE.JS SCENE ---
        let scene, camera, renderer, earthMesh;

        function initThree() {
            const container3D = document.getElementById('three-canvas-container');
            if (!container3D) return;

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, container3D.clientWidth / container3D.clientHeight, 0.1, 1000);
            camera.position.z = 2.5;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container3D.clientWidth, container3D.clientHeight);
            renderer.setClearColor(0x000000, 0);
            container3D.appendChild(renderer.domElement);

            scene.add(new THREE.AmbientLight(0xcccccc, 0.7));
            const pointLight = new THREE.PointLight(0x22d3ee, 1.5, 10);
            pointLight.position.set(2, 3, 4);
            scene.add(pointLight);

            const textureLoader = new THREE.TextureLoader();
            textureLoader.load(
                'https://s3-us-west-2.amazonaws.com/s.cdpn.io/141228/earthmap1k.jpg',
                (texture) => {
                    const geometry = new THREE.SphereGeometry(1, 64, 64);
                    const material = new THREE.MeshStandardMaterial({ 
                        map: texture, metalness: 0.1, roughness: 0.7,
                        emissive: '#22d3ee', emissiveIntensity: 0.05
                    });
                    earthMesh = new THREE.Mesh(geometry, material);
                    scene.add(earthMesh);
                    container3D.classList.add('interactive');
                },
                undefined,
                (err) => {
                    console.error('Texture failed to load.', err);
                    const fallbackGeo = new THREE.SphereGeometry(1, 32, 32);
                    const fallbackMat = new THREE.MeshStandardMaterial({ color: 0x22d3ee, emissive: 0x22d3ee, emissiveIntensity: 0.2 });
                    earthMesh = new THREE.Mesh(fallbackGeo, fallbackMat);
                    scene.add(earthMesh);
                    container3D.classList.add('interactive');
                }
            );
            
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };
            const domEl = renderer.domElement;
            domEl.addEventListener('mousedown', (e) => { isDragging = true; previousMousePosition = { x: e.clientX, y: e.clientY }; });
            domEl.addEventListener('mouseup', () => { isDragging = false; });
            domEl.addEventListener('mouseleave', () => { isDragging = false; });
            domEl.addEventListener('mousemove', (e) => {
                if (!isDragging || !earthMesh) return;
                const delta = { x: e.clientX - previousMousePosition.x, y: e.clientY - previousMousePosition.y };
                earthMesh.rotation.y += delta.x * 0.005;
                earthMesh.rotation.x += delta.y * 0.005;
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });
            domEl.addEventListener('wheel', (e) => {
                e.preventDefault();
            });
        }

        function animateThree() {
            requestAnimationFrame(animateThree);
            if (earthMesh) {
                earthMesh.rotation.y += 0.001;
            }
            if(renderer) renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            const container3D = document.getElementById('three-canvas-container');
            if(camera && renderer && container3D) {
                camera.aspect = container3D.clientWidth / container3D.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container3D.clientWidth, container3D.clientHeight);
            }
        }
    </script>
</body>
</html>
