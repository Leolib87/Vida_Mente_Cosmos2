<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulación de Autopoiesis Fractal | Origen, Mente y Cosmos</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        :root {
            --bg-color: #000508;
            --primary-text: #00FFC2;
            --primary-glow: #00FFFF;
            --secondary-glow: #00FF00;
            --font-main: 'Orbitron', sans-serif;
            --nav-height: 70px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { scroll-behavior: smooth; }

        body {
            background-color: var(--bg-color);
            color: var(--primary-text);
            font-family: var(--font-main);
            line-height: 1.8;
            overflow-x: hidden;
            transition: overflow 0.3s ease;
        }
        
        body.menu-open {
            overflow: hidden;
        }
        
        /* --- NAVEGACIÓN --- */
        nav {
            position: fixed; top: 0; width: 100%; height: var(--nav-height);
            background: rgba(0, 10, 15, 0.6);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            z-index: 1000;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            display: flex; justify-content: center; align-items: center;
            padding: 0 2rem;
        }

        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1440px;
        }
        
        .nav-logo a {
             font-size: 1.3em;
             font-weight: 700;
             color: #fff;
             text-decoration: none;
             text-shadow: 0 0 8px var(--primary-glow);
        }

        .nav-container { display: flex; justify-content: center; align-items: center; list-style: none; height: 100%; gap: 0.5rem;}
        nav .nav-container > li { position: relative; height: 100%; display: flex; align-items: center; }
        nav .nav-container > li > a {
            color: var(--primary-text); text-decoration: none; font-size: clamp(0.9em, 1.2vw, 1.05em); font-weight: 500;
            transition: color 0.3s ease, text-shadow 0.3s ease; padding: 0 1rem; display: flex; align-items: center; gap: 8px;
        }
        nav .nav-container > li > a:hover, nav .nav-container > li:hover > a { color: #FFFFFF; text-shadow: 0 0 12px var(--primary-glow); }
        
        .nav-icon { width: 20px; height: 20px; stroke-width: 1.5; }
        
        /* --- MEGA MENÚ --- */
        .mega-menu {
            position: fixed;
            top: var(--nav-height);
            left: 50%;
            transform: translateX(-50%) scale(0.95);
            background: rgba(0, 15, 20, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid var(--primary-glow);
            box-shadow: 0 10px 40px rgba(0, 255, 255, 0.25);
            border-radius: 10px; width: auto;
            min-width: clamp(300px, 80vw, 950px); max-width: 95vw;
            padding: 2rem; 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 2rem; 
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0s 0.3s;
            transform-origin: top center;
        }
        
        .mega-menu.is-active { 
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) scale(1);
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0s 0s;
        }
        
        .mega-menu.mega-menu-single {
            min-width: 280px;
            max-width: 350px;
            grid-template-columns: 1fr;
        }

        .mega-menu h3 {
            color: var(--primary-glow); font-size: 1.1em; margin-bottom: 1rem;
            text-shadow: 0 0 5px var(--primary-glow);
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
            padding-bottom: 0.75rem;
        }
        .mega-menu ul { display: flex; flex-direction: column; gap: 0.75rem; list-style: none; }
        .mega-menu a {
            font-size: 0.9em; color: var(--primary-text); text-decoration: none;
            transition: color 0.3s, padding-left 0.3s, background-color 0.3s;
            padding: 0.5rem 0.75rem; border-radius: 4px;
        }
        .mega-menu a:hover { color: #000; background-color: var(--primary-glow); padding-left: 1.25rem; }
        
        /* --- ESTILOS DE PÁGINA --- */
        .page-header {
            position: relative;
            text-align: center;
            padding: 6rem 1rem;
            margin-bottom: 2rem;
            min-height: 40vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #particles-js {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .header-content {
            position: relative;
            z-index: 2;
        }
        
        .header-content h1 {
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            font-weight: 700;
            color: #fff;
            text-shadow: 0 0 10px var(--primary-glow), 0 0 20px var(--primary-glow), 0 0 40px rgba(0, 255, 255, 0.7);
            animation: pulse-glow 3s infinite alternate;
        }

        @keyframes pulse-glow {
            from { text-shadow: 0 0 10px var(--primary-glow), 0 0 20px var(--primary-glow); }
            to { text-shadow: 0 0 20px var(--primary-glow), 0 0 40px var(--primary-glow); }
        }

        .main-container { max-width: 1440px; margin: 0 auto; padding: 1rem; padding-top: var(--nav-height); }
        .layout-grid { display: grid; grid-template-columns: 1fr; gap: 2rem; margin-top: 0; }
        
        .section {
            padding: clamp(1.5rem, 5vw, 2.5rem);
            background: linear-gradient(145deg, rgba(0, 40, 40, 0.3), rgba(0, 20, 20, 0.2));
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 12px; margin-bottom: 2rem;
        }
        
        h2 {
            font-size: clamp(1.8rem, 5vw, 2.5rem); color: var(--primary-text); text-shadow: 0 0 8px var(--secondary-glow);
            border-bottom: 1px solid var(--primary-glow); padding-bottom: 1rem; margin-bottom: 1.5rem;
        }
        h3 { font-size: clamp(1.2rem, 4vw, 1.5rem); color: var(--primary-glow); margin: 2rem 0 1rem 0; }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            align-items: center;
        }

        button {
            background: none;
            border: 1px solid var(--primary-glow);
            color: var(--primary-glow);
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            transition: all 0.3s ease;
            text-shadow: 0 0 5px var(--primary-glow);
        }
        button:hover {
            background: var(--primary-glow);
            color: #000;
            box-shadow: 0 0 15px var(--primary-glow);
        }
        input[type="range"] {
            width: 100%;
            accent-color: var(--primary-glow);
        }

        #visualization {
            width: 100%;
            height: 80vh;
            max-height: 800px;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(0,255,255,0.2);
            border-radius: 8px;
            margin-top: 2rem;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #visualization canvas {
             border-radius: 8px;
        }

        #status {
            padding: 1rem;
            background-color: rgba(0,0,0,0.5);
            border-radius: 8px;
            border: 1px solid rgba(0,255,255,0.2);
            margin-top: 1rem;
        }
        
        @media (min-width: 1025px) {
            .nav-logo { display: none; }
            .menu-toggle { display: none; }
            .nav-container { display: flex; }
        }

        @media (max-width: 1024px) {
            .nav-content { justify-content: space-between; }
            .nav-container {
                position: fixed; top: var(--nav-height); left: 0;
                width: 100%; max-width: 100%;
                height: calc(100vh - var(--nav-height));
                background: rgba(0, 5, 8, 0.98);
                backdrop-filter: blur(15px);
                flex-direction: column; justify-content: flex-start;
                align-items: center;
                transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
                transform: translateY(-110%);
                overflow-y: auto; padding: 2rem;
            }
            body.menu-open .nav-container { transform: translateY(0); }

            nav .nav-container > li { width: 100%; height: auto; flex-direction: column; align-items: center; text-align: center; }
            nav .nav-container > li > a { padding: 1rem; width: 100%; font-size: 1.5em;}
            
            .mega-menu {
                position: static; display: grid; opacity: 1; transform: none; visibility: visible; width: 100%; box-shadow: none; 
                border: none; padding: 1rem 0 1.5rem 0; background: none; backdrop-filter: none;
                grid-template-columns: 1fr; border-top: 1px solid rgba(0, 255, 255, 0.2); margin-top: 1rem;
            }
            
            .mega-menu h3 { font-size: 1.8em; }
            .mega-menu ul { align-items: stretch; text-align: left; list-style: none; padding-left: 0; }
            .mega-menu li { position: relative; }
            .mega-menu a {
                font-size: 1.5em; padding: 0.8rem 1rem 0.8rem 2.5rem;
                transition: color 0.3s, background-color 0.3s;
                display: block; text-align: left; position: relative;
            }
            .mega-menu a::before {
                content: '■'; color: var(--primary-glow);
                position: absolute; left: 0.5rem; top: 50%;
                transform: translateY(-50%) scale(0.6); font-size: 1.5em;
            }
            .mega-menu a:hover { padding-left: 2.5rem; color: #000; background-color: var(--primary-glow); }
            .mega-menu a:hover::before { color: #000; }
            
            .menu-toggle { display: block; position: relative; z-index: 1001; width: 30px; height: 22px; background: none; border: none; cursor: pointer; }
            .icon-bar { display: block; width: 100%; height: 3px; background-color: var(--primary-text); margin: 6px 0; transition: all 0.3s ease-in-out; border-radius: 2px; }
            body.menu-open .menu-toggle .icon-bar:nth-child(1) { transform: rotate(45deg) translate(7px, 7px); }
            body.menu-open .menu-toggle .icon-bar:nth-child(2) { opacity: 0; }
            body.menu-open .menu-toggle .icon-bar:nth-child(3) { transform: rotate(-45deg) translate(7px, -7px); }

            #visualization { height: 60vh; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-content">
            <div class="nav-logo">
                <a href="index.html">O.M.C.</a>
            </div>
            <ul class="nav-container" id="nav-menu">
                <li><a href="index.html">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                    Inicio</a></li>
    
                <li><a href="#">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>
                    Origen del Cosmos</a>
                    <div class="mega-menu">
                        <div><h3>Sistemas Complejos a Gran Escala</h3>
                            <ul>
                                <li><a href="GAME_OF_LIFE.HTML">Juego de la Vida (Conway)</a></li>
                                <li><a href="GAME_OF_LIFE3D.HTML">Juego de la Vida (3D)</a></li>
                            </ul>
                        </div>
                        <div><h3>Principios Fundamentales</h3>
                            <ul>
                                <li><a href="#">(Próximamente: Física)</a></li>
                                <li><a href="#">(Próximamente: Cosmología)</a></li>
                            </ul>
                        </div>
                    </div>
                </li>
                
                <li><a href="#">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v4.586a1 1 0 01-.293.707l-2 2a1 1 0 01-1.414 0l-2-2A1 1 0 018 9.586V5l-1-1z" /></svg>
                    Origen de la Vida</a>
                    <div class="mega-menu">
                        <div><h3>Fundamentos de Biología</h3>
                            <ul>
                                <li><a href="#biologia-celular">Introducción a la Célula</a></li>
                                <li><a href="CURSO_BIOLOGIA_CELULAR.HTML">Curso Biología Celular</a></li>
                                <li><a href="HISTOLOGIA.html">Histología y Tejidos</a></li>
                                <li><a href="cuerpo humano completo plantilla Lt.html">Anatomía Humana</a></li>
                            </ul>
                        </div>
                        <div><h3>Autopoiesis y Sistemas Vivos</h3>
                            <ul>
                                <li><a href="AUTOPOIESIS.HTML">Simulación Autopoiesis</a></li>
                                <li><a href="AUTOPOIESIS_3D.HTML">Simulación Autopoiesis (3D)</a></li>
                                <li><a href="Autopoiesis_Fractal00.html">Simulación Autopoiesis (Fractal)</a></li>
                                <li><a href="Paper_Varela_1974.html">Paper de Varela (1974)</a></li>
                            </ul>
                        </div>
                        <div><h3>Herramientas de Investigación</h3>
                            <ul>
                                <li><a href="https://leolib87.github.io/herbario/">Herbario Digital</a></li>
                                <li><a href="WESTERNCHILE.HTML">Proveedores Western Blot</a></li>
                                <li><a href="histologychile.html">Proveedores Histología</a></li>
                                <li><a href="proveedores_biologia.html">Proveedores Biología</a></li>
                            </ul>
                        </div>
                    </div>
                </li>
                
                <li><a href="#">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                    Origen de la Mente</a>
                    <div class="mega-menu">
                        <div><h3>Filosofía y Ciencias Cognitivas</h3>
                            <ul>
                                <li><a href="#filosofia-mente">Mente, Lenguaje y Realidad</a></li>
                                <li><a href="#ciencias-cognitivas">Mente Encarnada y Cognición</a></li>
                                <li><a href="#inteligencia-artificial">IA y Sistemas Complejos</a></li>
                                <li><a href="Feno_style.html">Aproximación Fenomenológica</a></li>
                                <li><a href="#epistemologia">Epistemología del Conocer</a></li>
                                <li><a href="#trazado-vida">Sentido de Vida y Muerte</a></li>
                            </ul>
                        </div>
                        <div><h3>Autores y Referentes</h3>
                            <ul>
                                <li><a href="PAPERS_VARELA.HTML">Publicaciones de Varela</a></li>
                                <li><a href="CITAS.HTML">Fragmentos de Mentes</a></li>
                                <li><a href="MAPEO_FILO_MENTE_CHILE.HTML">Mapeo Filosofía Mente (Chile)</a></li>
                            </ul>
                        </div>
                        <div><h3>Reflexiones Culturales</h3>
                             <ul>
                                <li><a href="peliculas.html">Reflexiones en el Cine</a></li>
                                <li><a href="MUSICA.HTML">Letras de Canciones</a></li>
                            </ul>
                        </div>
                    </div>
                </li>
    
                <li><a href="#">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V7a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                    Cartografías del Saber</a>
                    <div class="mega-menu">
                         <div><h3>Visualización de Redes y Datos</h3>
                            <ul>
                                <li><a href="#analisis-redes">Introducción a las Redes</a></li>
                                <li><a href="#elementos-comunes">Mapa Conceptual General</a></li>
                                <li><a href="RED POLITICOS.html">Red de Políticos</a></li>
                                <li><a href="varios graficos.html">Colección de Gráficos</a></li>
                                <li><a href="GRAFICO DE LINEAS Y TREEMAP.html">Líneas y Treemaps</a></li>
                                <li><a href="treemap_ias.html">Treemap de IAs</a></li>
                            </ul>
                        </div>
                        <div><h3>Mapas Conceptuales</h3>
                            <ul>
                                <li><a href="MAPA_MENTAL_TRABAJO.HTML">Mapa Mental "Trabajo"</a></li>
                                <li><a href="VARELA_CARTOGRAFIA.HTML">Cartografía Varela (3D)</a></li>
                                <li><a href="cartografia_varela_01.html">Cartografía Varela (2D)</a></li>
                                <li><a href="Explorando la Visualización Filosófica.HTML">Visualización Filosófica</a></li>
                            </ul>
                        </div>
                         <div><h3>Herramientas Digitales y IA</h3>
                            <ul>
                                <li><a href="Herramientas_Investigacion_definitiva.html">Guía de Herramientas</a></li>
                                <li><a href="IAS_BUSQUEDA.HTML">Buscador de IAs</a></li>
                                <li><a href="googleias.html">IAs de Google</a></li>
                                <li><a href="IAs.html">Red de IAs</a></li>
                                <li><a href="#voyant-tools">Análisis con Voyant Tools</a></li>
                                <li><a href="Paper_web.html">Plantilla Web para Papers</a></li>
                            </ul>
                        </div>
                         <div><h3>Recursos y Proyectos</h3>
                            <ul>
                                <li><a href="MI_BIBLIOTECA.HTML">Biblioteca Humanidades</a></li>
                                <li><a href="BIBLIOTECA_CIENCIAS.HTML">Biblioteca Ciencias</a></li>
                                <li><a href="BIBLIOECAS_DIGITALES_SOMBRA.HTML">Bibliotecas Sombra</a></li>
                                <li><a href="FUENTES_FINANCIAMIENTO.HTML">Fuentes de Financiamiento</a></li>
                                <li><a href="FONDOS.HTML">DEEP Financiamiento</a></li>
                                <li><a href="FONDECYT.HTML">Análisis Proyectos Fondecyt</a></li>
                                <li><a href="Empleos_IES.html">Empleos en Educación Superior</a></li>
                                <li><a href="Pedagogia-Biologia.html">Pedagogías en Biología (Chile)</a></li>
                                <li><a href="QF.HTML">Química y Farmacia (Chile)</a></li>
                            </ul>
                        </div>
                    </div>
                </li>

                <li><a href="#">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v4.586a1 1 0 01-.293.707l-2 2a1 1 0 01-1.414 0l-2-2A1 1 0 018 9.586V5l-1-1z" /></svg>
                    Laboratorio</a>
                    <div class="mega-menu mega-menu-single">
                        <div>
                            <h3>Laboratorio Experimental</h3>
                            <ul>
                                 <li><a href="LEOLIB NEWS BLACK.HTML">Leolib News</a></li>
                                 <li><a href="CHAT_LEO.HTML">Chat Leo</a></li>
                                 <li><a href="horario_2025.html">Horario 2025</a></li>
                                 <li><a href="HORARIOS_LAB.HTML">Horarios Lab</a></li>
                                 <li><a href="INTEGRAL1sd.HTML">Integral 1</a></li>
                                 <li><a href="red 2.html">Red Tesis Enseñanza Cs.</a></li>
                                 <li><a href="red3.html">Red Tesis Ejemplos</a></li>
                                 <li><a href="web.moderna.html">Web Moderna (Test)</a></li>
                                 <li><a href="web.three.html">Web Three.js (Test)</a></li>
                                 <li><a href="totem.html">Totem 1</a></li>
                                 <li><a href="totem2.html">Totem 2</a></li>
                                 <li><a href="PROBANDO.HTML">Probando 1</a></li>
                                 <li><a href="probando2gemini.html">Probando 2</a></li>
                            </ul>
                        </div>
                    </div>
                </li>
                
                <li><a href="#contacto">
                    <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                    Contacto</a></li>
            </ul>
            <button class="menu-toggle" id="menu-toggle-btn" aria-label="Abrir o cerrar menú">
                <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
            </button>
        </div>
    </nav>

    <div class="main-container">
        <div class="page-header">
            <div id="particles-js"></div>
            <div class="header-content">
                <h1>Autopoiesis Fractal</h1>
            </div>
        </div>

        <div class="layout-grid">
            <div class="section" id="controls">
                <h2>Controles de Simulación</h2>
                <div class="controls-grid">
                    <div>
                        <p>Enzimas: <span id="enzymeCountValue">10</span></p>
                        <input type="range" id="enzymeCount" min="1" max="50" value="10">
                    </div>
                    <div>
                        <p>Velocidad de Sustrato: <span id="substrateSpeedValue">5</span></p>
                        <input type="range" id="substrateSpeed" min="1" max="10" value="5">
                    </div>
                    <div>
                        <p>Tasa de Decaimiento: <span id="decayRateValue">0.001</span></p>
                        <input type="range" id="decayRate" min="0" max="0.01" step="0.0001" value="0.001">
                    </div>
                    <button onclick="simulation.reset()">Reiniciar</button>
                </div>
                <div id="status"></div>
            </div>

            <div class="section">
                 <h2>Simulación Fractal</h2>
                 <div id="visualization"></div>
            </div>

            <div class="section" id="intro">
                <h2>Autopoiesis a Múltiples Escalas</h2>
                <p>Esta simulación explora la autopoiesis desde una perspectiva fractal. Cada célula de la cuadrícula es, potencialmente, un universo en sí misma. Al hacer zoom en una célula, revelamos una nueva simulación en su interior, un sistema dentro de un sistema. Este modelo visualiza cómo los principios de autoorganización pueden operar recursivamente a través de diferentes niveles de complejidad, desde lo micro a lo macro, reflejando patrones que vemos en la naturaleza, desde las células hasta los ecosistemas.</p>
            </div>

            <footer class="footer">
                <p>Explorando la Autopoiesis | 2025</p>
            </footer>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script>
        // --- INICIALIZACIÓN DE PARTICLES.JS ---
        if (document.getElementById('particles-js')) {
            particlesJS("particles-js", {
                "particles": { "number": { "value": 60, "density": { "enable": true, "value_area": 800 } }, "color": { "value": "#00ffff" }, "shape": { "type": "circle" }, "opacity": { "value": 0.5, "random": true }, "size": { "value": 2, "random": true }, "line_linked": { "enable": true, "distance": 150, "color": "#00ffc2", "opacity": 0.3, "width": 1 }, "move": { "enable": true, "speed": 1, "direction": "none", "random": true, "straight": false, "out_mode": "out" } },
                "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": true, "mode": "grab" }, "onclick": { "enable": true, "mode": "push" }, "resize": true }, "modes": { "grab": { "distance": 140, "line_linked": { "opacity": 0.7 } }, "push": { "particles_nb": 4 } } }, "retina_detect": true
            });
        }

        // --- SCRIPTS DE NAVEGACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggleBtn = document.getElementById('menu-toggle-btn');
            const navMenu = document.getElementById('nav-menu');

            const toggleMenu = (e) => {
                e.stopPropagation();
                document.body.classList.toggle('menu-open');
            };

            const closeMenu = () => {
                if (document.body.classList.contains('menu-open')) {
                    document.body.classList.remove('menu-open');
                }
            };
            
            menuToggleBtn.addEventListener('click', toggleMenu);
            navMenu.addEventListener('click', (e) => {
                if (e.target.tagName === 'A') {
                   closeMenu();
                }
            });
            document.addEventListener('click', (e) => {
                if (document.body.classList.contains('menu-open') && !navMenu.contains(e.target) && !menuToggleBtn.contains(e.target)) {
                    closeMenu();
                }
            });

            if (window.matchMedia('(min-width: 1025px)').matches) {
                const menuItems = document.querySelectorAll('.nav-container > li');
                menuItems.forEach(item => {
                    const megaMenu = item.querySelector('.mega-menu');
                    if (megaMenu) {
                        let leaveTimeout;
                        const showMenu = () => {
                            clearTimeout(leaveTimeout);
                            document.querySelectorAll('.mega-menu.is-active').forEach(m => {
                                if (m !== megaMenu) m.classList.remove('is-active');
                            });
                            megaMenu.classList.add('is-active');
                        };
                        const startHideTimer = () => {
                            leaveTimeout = setTimeout(() => megaMenu.classList.remove('is-active'), 250);
                        };
                        item.addEventListener('mouseenter', showMenu);
                        item.addEventListener('mouseleave', startHideTimer);
                        megaMenu.addEventListener('mouseenter', () => clearTimeout(leaveTimeout));
                        megaMenu.addEventListener('mouseleave', startHideTimer);
                    }
                });
            }
        });

        // --- SCRIPT DE SIMULACIÓN P5.JS ---
        class Simulation {
            constructor(cols, rows, cellSize, level = 0) {
                this.cols = cols;
                this.rows = rows;
                this.cellSize = cellSize;
                this.level = level;
                this.grid = [];
                this.substrate = [];
                this.enzymes = [];
                this.links = [];
                this.zoom = 1;
                this.targetZoom = 1;
                this.focusedCell = null;
                this.childSimulation = null;
                this.init();
            }

            init() {
                this.grid = Array(this.cols).fill().map(() => Array(this.rows).fill(0));
                this.reset();
            }

            reset() {
                this.substrate = [];
                this.enzymes = [];
                this.links = [];
                this.grid.forEach(row => row.fill(0));
                for (let i = 0; i < 5000 / (this.level + 1); i++) {
                    let x = floor(random(this.cols));
                    let y = floor(random(this.rows));
                    if (this.grid[x][y] === 0) {
                        this.grid[x][y] = 1;
                        this.substrate.push({ x, y });
                    }
                }
                for (let i = 0; i < enzymeCount; i++) {
                    let x, y;
                    do {
                        x = floor(random(this.cols));
                        y = floor(random(this.rows));
                    } while (this.grid[x][y] !== 0);
                    this.grid[x][y] = 2;
                    this.enzymes.push({ x, y });
                }
            }

            update() {
                this.moveSubstrate();
                this.interact();
                this.disintegrateLinks();
                this.updateZoom();
                if (this.childSimulation) this.childSimulation.update();
            }

            moveSubstrate() {
                for (let s of this.substrate) {
                    if (random() < substrateSpeed / 10) {
                        let dir = floor(random(4));
                        let newX = s.x + [1, 0, -1, 0][dir];
                        let newY = s.y + [0, 1, 0, -1][dir];
                        if (this.isValid(newX, newY) && this.grid[newX][newY] === 0) {
                            this.grid[s.x][s.y] = 0;
                            s.x = newX;
                            s.y = newY;
                            this.grid[s.x][s.y] = 1;
                        }
                    }
                }
            }

            interact() {
                for (let enzyme of this.enzymes) {
                    let neighbors = this.getNeighbors(enzyme.x, enzyme.y);
                    let substrateNeighbors = neighbors.filter(n => this.grid[n.x][n.y] === 1);
                    if (substrateNeighbors.length >= 2) {
                        let s1 = substrateNeighbors[0];
                        let s2 = substrateNeighbors[1];
                        this.grid[s1.x][s1.y] = 3;
                        this.grid[s2.x][s2.y] = 0;
                        this.substrate = this.substrate.filter(s => !(s.x === s1.x && s.y === s1.y) && !(s.x === s2.x && s.y === s2.y));
                        this.links.push({ x: s1.x, y: s1.y });
                    }
                }
            }

            disintegrateLinks() {
                for (let i = this.links.length - 1; i >= 0; i--) {
                    if (random() < decayRate) {
                        let l = this.links[i];
                        this.grid[l.x][l.y] = 1;
                        this.substrate.push({ x: l.x, y: l.y });
                        this.links.splice(i, 1);
                    }
                }
            }

            display() {
                if (this.childSimulation) {
                    this.childSimulation.display();
                    return;
                }

                push();
                translate(width / 2, height / 2);
                scale(this.zoom);
                translate(-this.cols * this.cellSize / 2, -this.rows * this.cellSize / 2);
                for (let i = 0; i < this.cols; i++) {
                    for (let j = 0; j < this.rows; j++) {
                        if (this.grid[i][j] === 1) fill(color(getComputedStyle(document.documentElement).getPropertyValue('--primary-text')));
                        else if (this.grid[i][j] === 2) fill(color(255, 0, 255)); // Magenta para catalizador
                        else if (this.grid[i][j] === 3) fill(color(getComputedStyle(document.documentElement).getPropertyValue('--primary-glow')));
                        else {
                            fill(color('rgba(0, 40, 40, 0.3)'));
                            stroke(color(getComputedStyle(document.documentElement).getPropertyValue('--primary-glow')));
                            strokeWeight(0.2);
                        }
                        rect(i * this.cellSize, j * this.cellSize, this.cellSize, this.cellSize);
                        noStroke();
                    }
                }
                pop();
            }

            getNeighbors(x, y) {
                let neighbors = [];
                for (let i = -1; i <= 1; i++) {
                    for (let j = -1; j <= 1; j++) {
                        if (i === 0 && j === 0) continue;
                        let newX = x + i;
                        let newY = y + j;
                        if (this.isValid(newX, newY)) neighbors.push({ x: newX, y: newY });
                    }
                }
                return neighbors;
            }

            isValid(x, y) {
                return x >= 0 && x < this.cols && y >= 0 && y < this.rows;
            }

            updateZoom() {
                this.zoom = lerp(this.zoom, this.targetZoom, 0.1);
                if (abs(this.zoom - this.cellFullScreenZoom()) < 0.01 && !this.childSimulation && this.focusedCell) {
                    this.childSimulation = new Simulation(this.cols, this.rows, this.cellSize, this.level + 1);
                } else if (this.zoom < this.cellFullScreenZoom() - 0.5 && this.childSimulation) {
                    this.childSimulation = null;
                }
            }

            cellFullScreenZoom() {
                return min(width / this.cellSize, height / this.cellSize);
            }

            maxZoom() {
                return this.cellFullScreenZoom();
            }

            setZoomTarget(delta, mx, my) {
                let gridX = floor((mx - width / 2) / (this.cellSize * this.zoom) + this.cols / 2);
                let gridY = floor((my - height / 2) / (this.cellSize * this.zoom) + this.rows / 2);
                if (this.isValid(gridX, gridY)) {
                    this.focusedCell = { x: gridX, y: gridY };
                    this.targetZoom -= delta / 10;
                    this.targetZoom = constrain(this.targetZoom, 1, this.maxZoom());
                }
            }
        }

        let simulation;
        let enzymeCount = 10;
        let substrateSpeed = 5;
        let decayRate = 0.001;
        let canvas;

        function setup() {
            const vizContainer = document.getElementById('visualization');
            canvas = createCanvas(vizContainer.clientWidth, vizContainer.clientHeight);
            canvas.parent('visualization');
            simulation = new Simulation(floor(width / 10), floor(height / 10), 10);
            setupControls();
            noStroke();
        }

        function windowResized() {
            const vizContainer = document.getElementById('visualization');
            resizeCanvas(vizContainer.clientWidth, vizContainer.clientHeight);
            simulation = new Simulation(floor(width / 10), floor(height / 10), 10, simulation.level);
        }

        function setupControls() {
            const updateControl = (id, valueId, callback) => {
                const slider = document.getElementById(id);
                const valueSpan = document.getElementById(valueId);
                slider.addEventListener('input', () => {
                    const val = slider.step === '0.0001' ? parseFloat(slider.value) : parseInt(slider.value);
                    valueSpan.textContent = slider.step === '0.0001' ? val.toFixed(4) : val;
                    callback(val);
                });
            };
            updateControl('enzymeCount', 'enzymeCountValue', val => enzymeCount = val);
            updateControl('substrateSpeed', 'substrateSpeedValue', val => substrateSpeed = val);
            updateControl('decayRate', 'decayRateValue', val => decayRate = val);
        }

        function draw() {
            background(0, 5, 8); // Fondo oscuro del tema
            simulation.update();
            simulation.display();
            displayStatus();
        }

        function displayStatus() {
            const statusEl = document.getElementById('status');
            if (statusEl) {
                statusEl.innerHTML = 
                    `Zoom: ${simulation.zoom.toFixed(1)} | Level: ${simulation.level} | ` +
                    `Substrate: ${simulation.substrate.length} | Links: ${simulation.links.length} | Enzymes: ${simulation.enzymes.length}`;
            }
        }

        function mouseWheel(event) {
            if (mouseX > 0 && mouseX < width && mouseY > 0 && mouseY < height) {
                simulation.setZoomTarget(event.delta, mouseX, mouseY);
                return false;
            }
        }
    </script>
</body>
</html>
